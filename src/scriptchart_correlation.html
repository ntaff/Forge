<!DOCTYPE HTML>
<meta charset="UTF-8">
<html>
<head>

<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/data.js"></script>
<script src="https://code.highcharts.com/modules/drilldown.js"></script>
<script src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>

<script>

window.onload = function() {

dataPoints = [];
obesite = [];

var fastFood = [];
var fastFood2 = [];




function addData2(data){
  for (var i = 0; i < data.length; i++) {
      dataPoints.push({
        x: data[i].etat,
        y: data[i].value
      });
  }

   output2 = dataPoints.map(function(obj) {
    return Object.keys(obj).sort().map(function(key) { 
      return obj[key];
    });
  });

   for (var k = 0; k < output2.length; k++) {
    obesite.push(output2[k])
    // nomEtats.push(output2[k][0])
  };


}




function addData(data) {
  for (var i = 0; i < data.length; i++) {
    fastFood.push({
      x: data[i].etat,
      y: data[i].quantite
    });
  }




  //convertir array of object to Array of arrays
  var output = fastFood.map(function(obj) {
    return Object.keys(obj).sort().map(function(key) { 
      return obj[key];
    });
  });

  //recupérer valeurs des états
  for (var j = 0; j < output.length; j++) {
    fastFood2.push(output[j])
  };

  



// Create the chart
Highcharts.chart('container', {
  chart: {
    type: 'column'
  },
  title: {
    text: "Corrélation entre le nombre de fast food et le taux d'obésité par états"
  },
  xAxis: {
    type: 'category',
    labels: {
      rotation: -45,
      style: {
        fontSize: '13px',
        fontFamily: 'Verdana, sans-serif'
      }
    }
  },
  yAxis: [{
    min: 0,
    max: 1200,
    title: {
      text: 'Nombre de fast food'
    }
    },{
        lineWidth: 1,
        min: 20,
        max: 40,
        opposite: true,
        title: {
            text: 'Taux obésite en %'
        }
  }],
  legend: {
    enabled: true
  },
  tooltip: {
    pointFormat: '<b>{point.y}</b>'
  },

  series: [{
    yAxis :0,
    name: 'Nbre fast food',
    data: fastFood2,
    dataLabels: {
      enabled: true,
      rotation: -90,
      color: '#FFFFFF',
      align: 'right',
      format: '{point.y}', // one decimal
      y: 10, // 10 pixels down from the top
      style: {
        fontSize: '13px',
        fontFamily: 'Verdana, sans-serif'
      }
    }
  },{
    yAxis: 1,
    type: 'spline',
    name: 'Obésité',
    data: obesite
  }]
});
console.log(obesite)

}




$.ajaxSetup({
    scriptCharset: "utf-8",
    contentType: "application/json; charset=utf-8"
});

$.getJSON("https://api.myjson.com/bins/19y34g", addData);
$.getJSON("https://api.myjson.com/bins/1epjyo", addData2);

}

</script>


</head>
<body>
<div id="container" style="min-width: 310px; height: 600px; margin: 0 auto"></div>
</body>
</html>



